# Iris 项目开发路线图

## 项目概述

Iris 是一个分布式服务器探针系统，使用 Rust + gRPC 实现，旨在提供轻量级、高性能的服务器监控解决方案。

## 开发阶段

### ✅ Phase 0: 项目初始化（已完成）

- [x] 项目结构搭建
- [x] gRPC 协议定义
- [x] Agent 基础指标采集（CPU、内存、磁盘、网络、进程）
- [x] Server 基础数据接收和内存存储
- [x] 单一二进制文件支持双模式运行

---

### 🚧 Phase 1: 核心功能完善（当前阶段）

#### 1.1 数据查询 API ✅

**目标**: 提供 HTTP REST API 用于查询采集的指标数据

**任务清单**:
- [x] 设计 RESTful API 接口规范
  - GET `/api/agents` - 获取所有 Agent 列表
  - GET `/api/agents/{id}/metrics` - 获取指定 Agent 的最新指标
  - GET `/api/agents/{id}/metrics/history` - 获取历史数据（支持时间范围查询）
- [x] 集成 HTTP 框架（使用 `axum`）
- [x] 实现 API 路由和处理器
- [x] 添加 CORS 支持
- [x] API 文档（docs/API.md）

**预期成果**: Server 可通过 HTTP API 查询实时和历史监控数据 ✅

---

#### 1.2 持久化存储

**目标**: 将监控数据持久化到数据库，支持历史数据查询和分析

**任务清单**:
- [ ] 选择存储方案
  - 时序数据库：InfluxDB / TimescaleDB
  - 关系数据库：PostgreSQL
- [ ] 设计数据表结构
  - agents 表：Agent 基本信息
  - metrics 表：时序指标数据
- [ ] 实现数据库连接池
- [ ] 实现数据写入逻辑
- [ ] 实现数据查询逻辑（支持时间范围、聚合查询）
- [ ] 数据保留策略（自动清理过期数据）
- [ ] 数据库迁移工具

**预期成果**: 监控数据可持久化存储，支持长期历史数据查询

---

#### 1.3 配置管理

**目标**: 支持配置文件和环境变量，提升系统灵活性

**任务清单**:
- [ ] 设计配置文件格式（TOML/YAML）
- [ ] 实现配置加载逻辑（支持环境变量覆盖）
- [ ] Server 配置项
  - 监听地址、端口
  - 数据库连接信息
  - 数据保留策略
  - HTTP API 配置
- [ ] Agent 配置项
  - Server 地址
  - 上报间隔
  - Agent ID/名称
  - 采集指标开关
- [ ] 配置验证和默认值

**预期成果**: 系统可通过配置文件灵活配置，无需重新编译

---

### 📊 Phase 2: 可视化与监控

#### 2.1 Web UI 开发 ✅

**目标**: 提供直观的 Web 界面展示监控数据

**技术选型**:
- 前端框架：Vue 3（CDN）
- 图表库：ECharts 5（CDN）
- 单文件 HTML，零构建

**任务清单**:
- [x] 项目初始化和技术栈选型
- [x] Dashboard 首页
  - 所有 Agent 概览
  - 关键指标汇总
- [x] Agent 详情页
  - 实时指标展示
  - 历史趋势图表
  - CPU、内存、磁盘、网络、进程详情
- [x] 响应式设计（支持移动端）
- [x] 自动刷新功能
- [ ] 暗色模式支持

**预期成果**: 用户可通过 Web 界面直观查看监控数据 ✅

---

#### 2.2 告警系统

**目标**: 支持阈值告警和通知推送

**任务清单**:
- [ ] 告警规则引擎
  - 支持多种条件（CPU > 80%、内存 > 90% 等）
  - 支持持续时间判断（连续 5 分钟超过阈值）
- [ ] 告警通知渠道
  - 邮件通知
  - Webhook（支持钉钉、企业微信、Slack）
  - 短信通知（可选）
- [ ] 告警历史记录
- [ ] 告警静默和恢复通知
- [ ] Web UI 告警配置界面

**预期成果**: 系统可自动检测异常并发送告警通知

---

### 🔧 Phase 3: 高级特性

#### 3.1 多 Agent 管理

**任务清单**:
- [ ] Agent 注册和心跳机制
- [ ] Agent 在线/离线状态检测
- [ ] Agent 分组管理
- [ ] Agent 标签和元数据
- [ ] 批量操作支持

---

#### 3.2 性能优化

**任务清单**:
- [ ] 数据压缩（gRPC 压缩）
- [ ] 数据采样和聚合
- [ ] 缓存机制（Redis）
- [ ] 查询性能优化
- [ ] 并发性能测试和优化

---

#### 3.3 安全增强

**任务清单**:
- [ ] Agent 认证（Token/证书）
- [ ] TLS 加密通信
- [ ] API 鉴权（JWT）
- [ ] 访问控制（RBAC）
- [ ] 审计日志

---

#### 3.4 扩展性

**任务清单**:
- [ ] 插件系统（自定义采集器）
- [ ] 自定义指标支持
- [ ] 导出器（Prometheus Exporter）
- [ ] 集成第三方监控系统

---

### 🚀 Phase 4: 生产就绪

#### 4.1 部署与运维

**任务清单**:
- [ ] Docker 镜像
- [ ] Docker Compose 一键部署
- [ ] Kubernetes Helm Chart
- [ ] 系统服务配置（systemd）
- [ ] 自动化部署脚本

---

#### 4.2 文档与测试

**任务清单**:
- [ ] 完善 API 文档
- [ ] 用户使用手册
- [ ] 部署指南
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试
- [ ] 性能基准测试

---

#### 4.3 社区与生态

**任务清单**:
- [ ] 开源协议选择
- [ ] 贡献指南
- [ ] Issue 模板
- [ ] CI/CD 流程
- [ ] 版本发布流程

---

## 里程碑

| 里程碑 | 目标版本 | 预期时间 | 核心功能 |
|--------|---------|---------|---------|
| MVP | v0.1.0 | - | 基础采集 + 内存存储 |
| Alpha | v0.2.0 | - | HTTP API + 持久化存储 |
| Beta | v0.3.0 | - | Web UI + 告警系统 |
| RC | v0.9.0 | - | 完整功能 + 生产就绪 |
| GA | v1.0.0 | - | 稳定版本发布 |

---

## 技术债务与优化

- [ ] 错误处理统一化
- [ ] 日志系统完善（结构化日志）
- [ ] 指标采集精度优化
- [ ] 代码重构和模块化
- [ ] 性能瓶颈分析和优化

---

## 参考资料

- [gRPC 官方文档](https://grpc.io/)
- [Rust 异步编程](https://rust-lang.github.io/async-book/)
- [Prometheus 监控最佳实践](https://prometheus.io/docs/practices/)
- [InfluxDB 时序数据库](https://docs.influxdata.com/)

---

**最后更新**: 2026-02-15
