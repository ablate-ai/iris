<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iris - ÊúçÂä°Âô®ÁõëÊéß</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .header p {
            margin-top: 5px;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .agent-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .agent-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .agent-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-online {
            background: #d4edda;
            color: #155724;
        }

        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }

        .agent-info {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .extra-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 12px;
            color: #666;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .extra-info-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .extra-info-item .label {
            color: #999;
        }

        .extra-info-item .value {
            font-weight: 600;
            color: #333;
        }

        .metric {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .metric-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .metric-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .cpu-bar { background: linear-gradient(90deg, #667eea, #764ba2); }
        .memory-bar { background: linear-gradient(90deg, #f093fb, #f5576c); }
        .disk-bar { background: linear-gradient(90deg, #4facfe, #00f2fe); }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }

        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #333;
        }

        .modal-body {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 30px;
        }

        .detail-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .info-item label {
            font-size: 12px;
            color: #666;
            display: block;
            margin-bottom: 5px;
        }

        .info-item value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .process-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .process-table th,
        .process-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .process-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
            font-size: 13px;
        }

        .process-table td {
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .agents-grid {
                grid-template-columns: 1fr;
            }

            .metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <div class="container">
                <h1>üîç Iris ÁõëÊéßÈù¢Êùø</h1>
                <p>ÂÆûÊó∂ÊúçÂä°Âô®ÊÄßËÉΩÁõëÊéß</p>
            </div>
        </div>

        <div class="container">
            <!-- ÁªüËÆ°Ê¶ÇËßà -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Âú®Á∫ø Agent</h3>
                    <div class="value">{{ agents.size }}</div>
                </div>
                <div class="stat-card">
                    <h3>Âπ≥Âùá CPU ‰ΩøÁî®Áéá</h3>
                    <div class="value">{{ avgCpu }}%</div>
                </div>
                <div class="stat-card">
                    <h3>Âπ≥ÂùáÂÜÖÂ≠ò‰ΩøÁî®Áéá</h3>
                    <div class="value">{{ avgMemory }}%</div>
                </div>
                <div class="stat-card">
                    <h3>ÊúÄÂêéÊõ¥Êñ∞</h3>
                    <div class="value" style="font-size: 16px;">{{ lastUpdate }}</div>
                </div>
            </div>

            <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
            <div v-if="loading" class="loading">
                <p>Âä†ËΩΩ‰∏≠...</p>
            </div>

            <!-- ÈîôËØØÊèêÁ§∫ -->
            <div v-if="error" class="error">
                {{ error }}
            </div>

            <!-- Agent ÂàóË°® -->
            <div class="agents-grid">
                <div v-for="agent in agentsList" :key="agent.agent_id"
                     class="agent-card"
                     @click="showAgentDetail(agent.agent_id)">
                    <div class="agent-header">
                        <div class="agent-name">{{ agent.hostname }}</div>
                        <span class="agent-status status-online">Âú®Á∫ø</span>
                    </div>
                    <div class="agent-info">
                        <div>Agent ID: {{ agent.agent_id }}</div>
                        <div v-if="agent.system_info">{{ agent.system_info.os_name }} {{ agent.system_info.arch }}</div>
                        <div>ÊúÄÂêé‰∏äÊä•: {{ formatTime(agent.last_seen) }}</div>
                    </div>
                    <div class="metrics" v-if="agent.metrics">
                        <div class="metric">
                            <div class="metric-label">CPU</div>
                            <div class="metric-value">{{ agent.metrics.cpu }}%</div>
                            <div class="metric-bar">
                                <div class="metric-bar-fill cpu-bar"
                                     :style="{width: agent.metrics.cpu + '%'}"></div>
                            </div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">ÂÜÖÂ≠ò</div>
                            <div class="metric-value">{{ agent.metrics.memory }}%</div>
                            <div class="metric-bar">
                                <div class="metric-bar-fill memory-bar"
                                     :style="{width: agent.metrics.memory + '%'}"></div>
                            </div>
                        </div>
                        <div class="metric" v-if="agent.metrics.disk !== undefined">
                            <div class="metric-label">Á£ÅÁõò</div>
                            <div class="metric-value">{{ agent.metrics.disk }}%</div>
                            <div class="metric-bar">
                                <div class="metric-bar-fill disk-bar"
                                     :style="{width: agent.metrics.disk + '%'}"></div>
                            </div>
                        </div>
                        <div class="metric" v-if="agent.metrics.load !== undefined">
                            <div class="metric-label">Ë¥üËΩΩ (1m)</div>
                            <div class="metric-value">{{ agent.metrics.load }}</div>
                        </div>
                    </div>
                    <div class="extra-info" v-if="agent.extra_info">
                        <div class="extra-info-item" v-if="agent.extra_info.uptime">
                            <span class="label">ËøêË°å:</span>
                            <span class="value">{{ agent.extra_info.uptime }}</span>
                        </div>
                        <div class="extra-info-item" v-if="agent.extra_info.cpu_cores">
                            <span class="label">Ê†∏ÂøÉ:</span>
                            <span class="value">{{ agent.extra_info.cpu_cores }}</span>
                        </div>
                        <div class="extra-info-item" v-if="agent.extra_info.network_sent">
                            <span class="label">‚Üë:</span>
                            <span class="value">{{ agent.extra_info.network_sent }}</span>
                        </div>
                        <div class="extra-info-item" v-if="agent.extra_info.network_recv">
                            <span class="label">‚Üì:</span>
                            <span class="value">{{ agent.extra_info.network_recv }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agent ËØ¶ÊÉÖÂºπÁ™ó -->
        <div class="modal" :class="{active: showModal}" @click.self="closeModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>{{ selectedAgent?.hostname || 'Agent ËØ¶ÊÉÖ' }}</h2>
                    <button class="close-btn" @click="closeModal">&times;</button>
                </div>
                <div class="modal-body" v-if="selectedAgent">
                    <!-- CPU ÂõæË°® -->
                    <div class="detail-section">
                        <h3>CPU ‰ΩøÁî®Áéá</h3>
                        <div id="cpuChart" class="chart-container"></div>
                    </div>

                    <!-- ÂÜÖÂ≠òÂõæË°® -->
                    <div class="detail-section">
                        <h3>ÂÜÖÂ≠ò‰ΩøÁî®Áéá</h3>
                        <div id="memoryChart" class="chart-container"></div>
                    </div>

                    <!-- Á≥ªÁªü‰ø°ÊÅØ -->
                    <div class="detail-section" v-if="selectedAgent.system">
                        <h3>Á≥ªÁªü‰ø°ÊÅØ</h3>
                        <div class="info-grid">
                            <div class="info-item" v-if="selectedAgent.system.system_info">
                                <label>Êìç‰ΩúÁ≥ªÁªü</label>
                                <value>{{ selectedAgent.system.system_info.os_name }}</value>
                            </div>
                            <div class="info-item" v-if="selectedAgent.system.system_info">
                                <label>Á≥ªÁªüÁâàÊú¨</label>
                                <value>{{ selectedAgent.system.system_info.os_version }}</value>
                            </div>
                            <div class="info-item" v-if="selectedAgent.system.system_info">
                                <label>Êû∂ÊûÑ</label>
                                <value>{{ selectedAgent.system.system_info.arch }}</value>
                            </div>
                            <div class="info-item" v-if="selectedAgent.system.system_info">
                                <label>ËøêË°åÊó∂Èó¥</label>
                                <value>{{ formatUptime(selectedAgent.system.system_info.uptime) }}</value>
                            </div>
                            <div class="info-item">
                                <label>CPU Ê†∏ÂøÉÊï∞</label>
                                <value>{{ selectedAgent.system.cpu?.core_count || 'N/A' }}</value>
                            </div>
                            <div class="info-item">
                                <label>ÊÄªÂÜÖÂ≠ò</label>
                                <value>{{ formatBytes(selectedAgent.system.memory?.total) }}</value>
                            </div>
                            <div class="info-item">
                                <label>Â∑≤Áî®ÂÜÖÂ≠ò</label>
                                <value>{{ formatBytes(selectedAgent.system.memory?.used) }}</value>
                            </div>
                            <div class="info-item">
                                <label>ÂèØÁî®ÂÜÖÂ≠ò</label>
                                <value>{{ formatBytes(selectedAgent.system.memory?.available) }}</value>
                            </div>
                        </div>
                    </div>

                    <!-- ÁΩëÁªúÊµÅÈáè -->
                    <div class="detail-section" v-if="selectedAgent.system?.network">
                        <h3>ÁΩëÁªúÊµÅÈáè</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>ÊÄª‰∏ä‰º†</label>
                                <value>{{ formatBytes(selectedAgent.system.network.bytes_sent) }}</value>
                            </div>
                            <div class="info-item">
                                <label>ÊÄª‰∏ãËΩΩ</label>
                                <value>{{ formatBytes(selectedAgent.system.network.bytes_recv) }}</value>
                            </div>
                            <div class="info-item">
                                <label>ÂèëÈÄÅÂåÖÊï∞</label>
                                <value>{{ formatNumber(selectedAgent.system.network.packets_sent) }}</value>
                            </div>
                            <div class="info-item">
                                <label>Êé•Êî∂ÂåÖÊï∞</label>
                                <value>{{ formatNumber(selectedAgent.system.network.packets_recv) }}</value>
                            </div>
                        </div>
                    </div>

                    <!-- Á£ÅÁõò‰ø°ÊÅØ -->
                    <div class="detail-section" v-if="selectedAgent.system?.disks?.length">
                        <h3>Á£ÅÁõò‰ΩøÁî®</h3>
                        <div class="info-grid">
                            <div class="info-item" v-for="disk in selectedAgent.system.disks" :key="disk.mount_point">
                                <label>{{ disk.mount_point }}</label>
                                <value>{{ disk.usage_percent?.toFixed(1) }}%</value>
                                <div class="metric-bar" style="margin-top: 8px;">
                                    <div class="metric-bar-fill disk-bar"
                                         :style="{width: disk.usage_percent + '%'}"></div>
                                </div>
                                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                    {{ formatBytes(disk.used) }} / {{ formatBytes(disk.total) }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ËøõÁ®ãÂàóË°® -->
                    <div class="detail-section" v-if="selectedAgent.system?.processes?.length">
                        <h3>Top ËøõÁ®ã</h3>
                        <table class="process-table">
                            <thead>
                                <tr>
                                    <th>PID</th>
                                    <th>ËøõÁ®ãÂêç</th>
                                    <th>CPU %</th>
                                    <th>ÂÜÖÂ≠ò</th>
                                    <th>Áä∂ÊÄÅ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="proc in selectedAgent.system.processes" :key="proc.pid">
                                    <td>{{ proc.pid }}</td>
                                    <td>{{ proc.name }}</td>
                                    <td>{{ proc.cpu_usage?.toFixed(1) }}%</td>
                                    <td>{{ formatBytes(proc.memory) }}</td>
                                    <td>{{ proc.status }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    agents: new Map(),
                    loading: true,
                    error: null,
                    showModal: false,
                    selectedAgent: null,
                    selectedAgentId: null,
                    history: [],
                    apiBase: '',
                    eventSource: null,
                    cpuChart: null,
                    memoryChart: null
                };
            },
            computed: {
                avgCpu() {
                    const agents = Array.from(this.agents.values());
                    if (agents.length === 0) return 0;
                    const sum = agents.reduce((acc, a) => acc + (a.metrics?.cpu || 0), 0);
                    return (sum / agents.length).toFixed(1);
                },
                avgMemory() {
                    const agents = Array.from(this.agents.values());
                    if (agents.length === 0) return 0;
                    const sum = agents.reduce((acc, a) => acc + (a.metrics?.memory || 0), 0);
                    return (sum / agents.length).toFixed(1);
                },
                lastUpdate() {
                    if (this.agents.size === 0) return '--';
                    return new Date().toLocaleTimeString('zh-CN');
                },
                agentsList() {
                    return Array.from(this.agents.values());
                }
            },
            methods: {
                async init() {
                    try {
                        // 1. È¶ñÊ¨°Âä†ËΩΩÔºöËé∑ÂèñÊâÄÊúâ Agent
                        const response = await fetch(`${this.apiBase}/api/agents`);
                        const data = await response.json();

                        if (data.success) {
                            // Ëé∑ÂèñÊØè‰∏™ Agent ÁöÑÊúÄÊñ∞ÊåáÊ†á
                            for (const agent of data.data) {
                                const metricsRes = await fetch(`${this.apiBase}/api/agents/${agent.agent_id}/metrics`);
                                const metricsData = await metricsRes.json();

                                if (metricsData.success) {
                                    this.updateAgent(metricsData.data);
                                }
                            }
                            this.error = null;
                        }
                    } catch (err) {
                        this.error = 'Êó†Ê≥ïËøûÊé•Âà∞ÊúçÂä°Âô®ÔºåËØ∑Á°Æ‰øù Server Ê≠£Âú®ËøêË°å';
                        console.error(err);
                    } finally {
                        this.loading = false;
                    }

                    // 2. Âª∫Á´ã SSE ËøûÊé•ÔºåÊé•Êî∂ÂÆûÊó∂Êõ¥Êñ∞
                    this.connectSSE();
                },

                connectSSE() {
                    this.eventSource = new EventSource(`${this.apiBase}/api/stream`);

                    this.eventSource.onmessage = (event) => {
                        try {
                            const metrics = JSON.parse(event.data);
                            this.updateAgent(metrics);
                        } catch (err) {
                            console.error('Ëß£Êûê SSE Êï∞ÊçÆÂ§±Ë¥•:', err);
                        }
                    };

                    this.eventSource.onerror = (error) => {
                        console.error('SSE ËøûÊé•ÈîôËØØ:', error);
                        this.eventSource.close();
                        // 3 ÁßíÂêéÈáçËøû
                        setTimeout(() => {
                            console.log('Â∞ùËØïÈáçÊñ∞ËøûÊé• SSE...');
                            this.connectSSE();
                        }, 3000);
                    };

                    this.eventSource.onopen = () => {
                        console.log('SSE ËøûÊé•Â∑≤Âª∫Á´ã');
                    };
                },

                updateAgent(metrics) {
                    const sys = metrics.system;
                    const agentData = {
                        agent_id: metrics.agent_id,
                        hostname: metrics.hostname,
                        last_seen: metrics.timestamp,
                        metrics: {
                            cpu: sys?.cpu?.usage_percent?.toFixed(1) || 0,
                            memory: sys?.memory?.usage_percent?.toFixed(1) || 0,
                            disk: sys?.disks?.[0]?.usage_percent?.toFixed(1),
                            load: sys?.cpu?.load_avg_1?.toFixed(2)
                        },
                        system_info: sys?.system_info,
                        extra_info: {
                            uptime: this.formatUptimeShort(sys?.system_info?.uptime),
                            cpu_cores: sys?.cpu?.core_count,
                            network_sent: this.formatBytesShort(sys?.network?.bytes_sent),
                            network_recv: this.formatBytesShort(sys?.network?.bytes_recv)
                        }
                    };

                    this.agents.set(metrics.agent_id, agentData);
                },

                async fetchAgents() {
                    // ‰øùÁïôÊ≠§ÊñπÊ≥ï‰ª•ÂÖºÂÆπÔºå‰ΩÜ‰∏çÂÜç‰ΩøÁî®ËΩÆËØ¢
                },
                async showAgentDetail(agentId) {
                    this.selectedAgentId = agentId;
                    this.showModal = true;

                    try {
                        // Ëé∑ÂèñÊúÄÊñ∞ÊåáÊ†á
                        const metricsRes = await fetch(`${this.apiBase}/api/agents/${agentId}/metrics`);
                        const metricsData = await metricsRes.json();

                        if (metricsData.success) {
                            this.selectedAgent = metricsData.data;
                        }

                        // Ëé∑ÂèñÂéÜÂè≤Êï∞ÊçÆ
                        const historyRes = await fetch(`${this.apiBase}/api/agents/${agentId}/metrics/history?limit=20`);
                        const historyData = await historyRes.json();

                        if (historyData.success) {
                            this.history = historyData.data;
                            this.$nextTick(() => {
                                this.renderCharts();
                            });
                        }
                    } catch (err) {
                        console.error('Ëé∑Âèñ Agent ËØ¶ÊÉÖÂ§±Ë¥•:', err);
                    }
                },
                closeModal() {
                    this.showModal = false;
                    this.selectedAgent = null;
                    this.history = [];
                    if (this.cpuChart) {
                        this.cpuChart.dispose();
                        this.cpuChart = null;
                    }
                    if (this.memoryChart) {
                        this.memoryChart.dispose();
                        this.memoryChart = null;
                    }
                },
                renderCharts() {
                    if (this.history.length === 0) return;

                    const times = this.history.map(h => new Date(h.timestamp).toLocaleTimeString('zh-CN'));
                    const cpuData = this.history.map(h => h.system?.cpu?.usage_percent?.toFixed(1) || 0);
                    const memoryData = this.history.map(h => h.system?.memory?.usage_percent?.toFixed(1) || 0);

                    // CPU ÂõæË°®
                    const cpuChartDom = document.getElementById('cpuChart');
                    if (cpuChartDom) {
                        this.cpuChart = echarts.init(cpuChartDom);
                        this.cpuChart.setOption({
                            tooltip: { trigger: 'axis' },
                            xAxis: { type: 'category', data: times },
                            yAxis: { type: 'value', max: 100, axisLabel: { formatter: '{value}%' } },
                            series: [{
                                name: 'CPU',
                                type: 'line',
                                smooth: true,
                                data: cpuData,
                                areaStyle: { color: 'rgba(102, 126, 234, 0.2)' },
                                lineStyle: { color: '#667eea' },
                                itemStyle: { color: '#667eea' }
                            }],
                            grid: { left: 50, right: 20, top: 20, bottom: 30 }
                        });
                    }

                    // ÂÜÖÂ≠òÂõæË°®
                    const memoryChartDom = document.getElementById('memoryChart');
                    if (memoryChartDom) {
                        this.memoryChart = echarts.init(memoryChartDom);
                        this.memoryChart.setOption({
                            tooltip: { trigger: 'axis' },
                            xAxis: { type: 'category', data: times },
                            yAxis: { type: 'value', max: 100, axisLabel: { formatter: '{value}%' } },
                            series: [{
                                name: 'ÂÜÖÂ≠ò',
                                type: 'line',
                                smooth: true,
                                data: memoryData,
                                areaStyle: { color: 'rgba(240, 147, 251, 0.2)' },
                                lineStyle: { color: '#f093fb' },
                                itemStyle: { color: '#f093fb' }
                            }],
                            grid: { left: 50, right: 20, top: 20, bottom: 30 }
                        });
                    }
                },
                formatTime(timestamp) {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diff = Math.floor((now - date) / 1000);

                    if (diff < 60) return `${diff} ÁßíÂâç`;
                    if (diff < 3600) return `${Math.floor(diff / 60)} ÂàÜÈíüÂâç`;
                    if (diff < 86400) return `${Math.floor(diff / 3600)} Â∞èÊó∂Ââç`;
                    return date.toLocaleString('zh-CN');
                },
                formatBytes(bytes) {
                    if (!bytes) return 'N/A';
                    const units = ['B', 'KB', 'MB', 'GB', 'TB'];
                    let size = bytes;
                    let unitIndex = 0;

                    while (size >= 1024 && unitIndex < units.length - 1) {
                        size /= 1024;
                        unitIndex++;
                    }

                    return `${size.toFixed(2)} ${units[unitIndex]}`;
                },
                formatUptime(seconds) {
                    if (!seconds) return 'N/A';
                    const days = Math.floor(seconds / 86400);
                    const hours = Math.floor((seconds % 86400) / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);

                    if (days > 0) {
                        return `${days} Â§© ${hours} Â∞èÊó∂`;
                    } else if (hours > 0) {
                        return `${hours} Â∞èÊó∂ ${minutes} ÂàÜÈíü`;
                    } else {
                        return `${minutes} ÂàÜÈíü`;
                    }
                },
                formatNumber(num) {
                    if (!num) return '0';
                    return num.toLocaleString('zh-CN');
                },
                formatUptimeShort(seconds) {
                    if (!seconds) return null;
                    const days = Math.floor(seconds / 86400);
                    const hours = Math.floor((seconds % 86400) / 3600);

                    if (days > 0) {
                        return `${days}Â§©${hours}Êó∂`;
                    } else if (hours > 0) {
                        return `${hours}Â∞èÊó∂`;
                    } else {
                        return `${Math.floor(seconds / 60)}ÂàÜÈíü`;
                    }
                },
                formatBytesShort(bytes) {
                    if (!bytes) return null;
                    const units = ['B', 'KB', 'MB', 'GB', 'TB'];
                    let size = bytes;
                    let unitIndex = 0;

                    while (size >= 1024 && unitIndex < units.length - 1) {
                        size /= 1024;
                        unitIndex++;
                    }

                    return `${size.toFixed(1)}${units[unitIndex]}`;
                }
            },
            mounted() {
                this.init();
            },
            beforeUnmount() {
                if (this.eventSource) {
                    this.eventSource.close();
                }
                if (this.cpuChart) {
                    this.cpuChart.dispose();
                }
                if (this.memoryChart) {
                    this.memoryChart.dispose();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
